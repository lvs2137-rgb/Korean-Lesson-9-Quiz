<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 9 Comprehensive Quiz - ÏÉùÏùº (Birthday)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
            padding: 40px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .main-menu {
            text-align: center;
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin: 30px 0 20px;
            font-weight: bold;
        }

        .menu-buttons {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .menu-btn {
            padding: 20px;
            font-size: 1.2em;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .menu-btn:hover {
            background: #764ba2;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .menu-btn-secondary {
            background: #95a5f5;
        }

        .menu-btn-secondary:hover {
            background: #667eea;
        }

        .quiz-area {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .question-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .question-text {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .word-type {
            display: inline-block;
            padding: 5px 15px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .input-answer {
            width: 100%;
            padding: 20px;
            font-size: 1.5em;
            border: 3px solid #667eea;
            border-radius: 10px;
            margin-top: 20px;
            font-family: inherit;
        }

        .input-answer:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }

        .override-btn {
            padding: 10px 20px;
            font-size: 0.95em;
            background: #ff9800;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            display: none;
        }

        .override-btn:hover {
            background: #f57c00;
        }

        .override-btn.show {
            display: inline-block;
        }

        .answer-comparison {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            font-size: 0.95em;
        }

        .answer-comparison strong {
            color: #667eea;
        }

        .next-btn {
            padding: 15px 40px;
            font-size: 1.1em;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            display: none;
        }

        .next-btn:hover {
            background: #764ba2;
        }

        .next-btn.show {
            display: inline-block;
        }

        .results {
            display: none;
            text-align: center;
        }

        .score-display {
            font-size: 4em;
            font-weight: bold;
            color: #667eea;
            margin: 30px 0;
        }

        .score-message {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 30px;
        }

        .result-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .result-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .result-btn.menu {
            background: #667eea;
        }

        .result-btn.menu:hover {
            background: #764ba2;
        }

        .result-btn.retry {
            background: #ff9800;
        }

        .result-btn.retry:hover {
            background: #f57c00;
        }

        .result-btn.missed {
            background: #e91e63;
        }

        .result-btn.missed:hover {
            background: #c2185b;
        }

        .result-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .hint {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }

        .sentence-context {
            background: #fff3e0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #ff9800;
        }

        .blank {
            display: inline-block;
            min-width: 100px;
            border-bottom: 2px solid #667eea;
            margin: 0 5px;
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Lesson 9 Comprehensive Quiz</h1>
            <p class="subtitle">9Í≥º ÏÉùÏùº (Birthday)</p>
        </div>

        <!-- Main Menu -->
        <div class="main-menu" id="mainMenu">
            <div class="section-title">üìö Vocabulary Quizzes</div>
            <div class="menu-buttons">
                <button class="menu-btn" onclick="startQuiz('vocab', 'korean-to-english')">
                    Vocabulary: ÌïúÍµ≠Ïñ¥ ‚Üí English
                </button>
                <button class="menu-btn" onclick="startQuiz('vocab', 'english-to-korean')">
                    Vocabulary: English ‚Üí ÌïúÍµ≠Ïñ¥
                </button>
                <button class="menu-btn" onclick="startQuiz('vocab', 'mixed')">
                    Vocabulary: Mixed
                </button>
            </div>

            <div class="section-title">‚úèÔ∏è Grammar Quizzes</div>
            <div class="menu-buttons">
                <button class="menu-btn menu-btn-secondary" onclick="startQuiz('grammar', 'particles')">
                    Grammar: Particles (ÌïúÌÖå/ÌïúÌÖåÏÑú/Íªò/ÍªòÏÑú)
                </button>
                <button class="menu-btn menu-btn-secondary" onclick="startQuiz('grammar', 'honorifics')">
                    Grammar: Honorifics (Plain vs Honorific)
                </button>
                <button class="menu-btn menu-btn-secondary" onclick="startQuiz('grammar', 'modifiers')">
                    Grammar: Adjective Modifiers ~(Ïúº)„Ñ¥
                </button>
            </div>
        </div>

        <!-- Quiz Area -->
        <div class="quiz-area" id="quizArea">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>

            <div class="question-card">
                <div class="question-number" id="questionNumber"></div>
                <div class="word-type" id="wordType"></div>
                <div id="sentenceContext" class="sentence-context" style="display: none;"></div>
                <div class="question-text" id="questionText"></div>
                
                <input type="text" class="input-answer" id="answerInput" placeholder="Type your answer..." autocomplete="off">
                <div class="hint" id="hint"></div>

                <div class="feedback" id="feedback"></div>
                <button class="override-btn" id="overrideBtn" onclick="overrideAnswer()">I Got It Right - Override</button>
                <button class="next-btn" id="nextBtn" onclick="nextQuestion()">Next Question</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="results" id="results">
            <h2>Quiz Complete! üéâ</h2>
            <div class="score-display" id="scoreDisplay"></div>
            <div class="score-message" id="scoreMessage"></div>
            <div class="result-buttons">
                <button class="result-btn menu" onclick="returnToMenu()">Return to Menu</button>
                <button class="result-btn retry" onclick="retryQuiz()">Retry Same Quiz</button>
                <button class="result-btn missed" id="missedBtn" onclick="retryMissed()">Practice Missed Only</button>
            </div>
        </div>
    </div>

    <script>
        const vocabulary = [
            // Nouns
            { korean: 'Í±¥Î¨º', english: 'building', type: 'NOUN' },
            { korean: 'Îèà', english: 'money', type: 'NOUN' },
            { korean: 'Îèå', english: 'the first birthday', type: 'NOUN' },
            { korean: 'Î©∞Ïπ†', english: 'what date; a few days', type: 'NOUN' },
            { korean: 'Î™®Ïûê', english: 'cap, hat', type: 'NOUN' },
            { korean: 'Î≤àÌò∏', english: 'number', type: 'NOUN' },
            { korean: 'Ïò¨Ìï¥', english: 'this year', type: 'NOUN' },
            { korean: 'Ïù¥Î©îÏùº', english: 'e-mail', type: 'NOUN' },
            { korean: 'ÏûîÏπò', english: 'feast, party', type: 'NOUN' },
            { korean: 'Ïπ¥Îìú', english: 'card', type: 'NOUN' },
            { korean: 'Ìé∏ÏßÄ', english: 'letter', type: 'NOUN' },
            { korean: 'Í∞ÄÏ°±', english: 'family', type: 'NOUN' },
            { korean: 'ÎÇòÏù¥', english: 'age', type: 'NOUN' },
            { korean: 'Îî∏', english: 'daughter', type: 'NOUN' },
            { korean: 'ÏÇ¨ÏßÑ', english: 'photo; picture', type: 'NOUN' },
            { korean: 'ÏÉùÏùº', english: 'birthday', type: 'NOUN' },
            { korean: 'ÏïÑÎì§', english: 'son', type: 'NOUN' },
            { korean: 'ÏûëÎÖÑ', english: 'last year', type: 'NOUN' },
            { korean: 'Ïû•Í∞ë', english: 'gloves', type: 'NOUN' },
            { korean: 'Ìï†Î®∏Îãà', english: 'grandmother', type: 'NOUN' },
            { korean: 'Ìï†ÏïÑÎ≤ÑÏßÄ', english: 'grandfather', type: 'NOUN' },
            { korean: 'Ïä§Ïõ®ÌÑ∞', english: 'sweater', type: 'NOUN' },
            { korean: 'ÏÉùÏã†', english: 'birthday (honorific)', type: 'NOUN (HON)', plain: 'ÏÉùÏùº' },
            { korean: 'ÎåÅ', english: 'home; house (honorific)', type: 'NOUN (HON)', plain: 'Ïßë' },
            { korean: 'ÏÑ±Ìï®', english: 'name (honorific)', type: 'NOUN (HON)', plain: 'Ïù¥Î¶Ñ' },
            { korean: 'Ïó∞ÏÑ∏', english: 'age (honorific)', type: 'NOUN (HON)', plain: 'ÎÇòÏù¥' },
            
            // Verbs
            { korean: 'Î≥¥ÎÇ¥Îã§', english: 'to send; to spend (time)', type: 'VERB' },
            { korean: 'Ï∂ïÌïòÌïòÎã§', english: 'to congratulate', type: 'VERB' },
            { korean: 'Ï∞çÎã§', english: 'to take (a photo)', type: 'VERB' },
            { korean: 'Ï£ΩÎã§', english: 'to die', type: 'VERB' },
            { korean: 'ÎìúÎ¶¨Îã§', english: 'to give (honorific)', type: 'VERB (HON)', plain: 'Ï£ºÎã§' },
            { korean: 'ÎìúÏãúÎã§', english: 'to eat (honorific)', type: 'VERB (HON)', plain: 'Î®πÎã§' },
            { korean: 'Ï£ºÎ¨¥ÏãúÎã§', english: 'to sleep (honorific)', type: 'VERB (HON)', plain: 'ÏûêÎã§' },
            { korean: 'ÎèåÏïÑÍ∞ÄÏãúÎã§', english: 'to pass away (honorific)', type: 'VERB (HON)', plain: 'Ï£ΩÎã§' },
            
            // Adjectives
            { korean: 'Í∏∏Îã§', english: 'to be long', type: 'ADJECTIVE' },
            { korean: 'ÏßßÎã§', english: 'to be short', type: 'ADJECTIVE' },
            { korean: 'Í±¥Í∞ïÌïòÎã§', english: 'to be healthy', type: 'ADJECTIVE' },
            { korean: 'Ï¶êÍ≤ÅÎã§', english: 'to be joyful', type: 'ADJECTIVE' },
            
            // Adverbs
            { korean: 'Î™®Îëê', english: 'all', type: 'ADVERB' },
            
            // Counters
            { korean: 'ÏÇ¥', english: 'years old', type: 'COUNTER' },
            { korean: 'Î∂Ñ', english: 'people (honorific)', type: 'COUNTER (HON)', plain: 'Î™Ö' },
        ];

        // Grammar questions
        const particleQuestions = [
            { sentence: 'Î¶∞Îã§Í∞Ä ÎßàÏù¥ÌÅ¥_____ Ï†ÑÌôîÌñàÏñ¥Ïöî.', answer: 'ÌïúÌÖå', hint: 'to a person' },
            { sentence: 'Ï†ÄÎäî Ïñ¥Ï†ú ÌïúÍµ≠___ Ï†ÑÌôîÌñàÏñ¥Ïöî.', answer: 'Ïóê', hint: 'to a place' },
            { sentence: 'Ï†úÎãàÍ∞Ä Î¶¨ÏÇ¨_____ ÏÉùÏùº ÏÑ†Î¨ºÏùÑ Ï§¨Ïñ¥Ïöî.', answer: 'ÌïúÌÖå', hint: 'to a person' },
            { sentence: 'Ïñ¥Ï†ú ÏπúÍµ¨_______ Ï†ÑÌôîÏôîÏñ¥Ïöî.', answer: 'ÌïúÌÖåÏÑú', hint: 'from a person' },
            { sentence: 'ÎùºÎîîÏò§_____ Îâ¥Ïä§Î•º Îì§Ïñ¥Ïöî.', answer: 'ÏóêÏÑú', hint: 'from a place/source' },
            { sentence: 'Ìè¥ÏùÄ Î∂ÄÎ™®Îãò___ Ìé∏ÏßÄÎ•º Ïç®Ïöî.', answer: 'Íªò', hint: 'to (honorific)' },
            { sentence: 'Î∞ò ÏπúÍµ¨_______ Ïù¥Î©îÏùºÏù¥ ÏôîÏñ¥Ïöî.', answer: 'ÌïúÌÖåÏÑú', hint: 'from a classmate' },
            { sentence: 'Ìï†Î®∏Îãà_____ ÏÑ†Î¨ºÏùÑ ÎìúÎ†∏Ïñ¥Ïöî.', answer: 'Íªò', hint: 'to (honorific)' },
            { sentence: 'ÍµêÏàòÎãò_______ Ï±ÖÏùÑ Î∞õÏïòÏñ¥Ïöî.', answer: 'Íªò', hint: 'from (honorific)' },
            { sentence: 'ÎèôÏÉù_____ Ïπ¥ÎìúÎ•º Î≥¥ÎÉàÏñ¥Ïöî.', answer: 'ÌïúÌÖå', hint: 'to (younger sibling)' },
            { sentence: 'ÏÑ†ÏÉùÎãò_____ Í∞êÏÇ¨Ìï©ÎãàÎã§.', answer: 'Íªò', hint: 'to (teacher - honorific)' },
            { sentence: 'ÏπúÍµ¨_____ Ìé∏ÏßÄÎ•º Î∞õÏïòÏñ¥Ïöî.', answer: 'ÌïúÌÖåÏÑú', hint: 'from (friend)' },
            { sentence: 'Ìï†ÏïÑÎ≤ÑÏßÄ_______ Ïö©ÎèàÏùÑ Î∞õÏïòÏñ¥Ïöî.', answer: 'Íªò', hint: 'from (grandfather - honorific)' },
            { sentence: 'Ïñ¥Î®∏Îãà_____ Ï†ÑÌôîÌï¥Ïöî.', answer: 'Íªò', hint: 'to (mother - honorific)' },
            { sentence: 'ÏïÑÎ≤ÑÏßÄ_______ Í±¥Í∞ïÌïòÏÑ∏Ïöî.', answer: 'ÍªòÏÑú', hint: 'subject particle (honorific)' },
        ];

        const honorificQuestions = [
            { sentence: 'Ìï†Î®∏ÎãàÍªòÏÑú ÏãùÏÇ¨Î•º _____. (Î®πÎã§)', answer: 'ÎìúÏÑ∏Ïöî', type: 'verb', hint: 'honorific form of Î®πÎã§' },
            { sentence: 'Ìï†ÏïÑÎ≤ÑÏßÄ_____ ÏßÄÍ∏à _____. (ÏûêÎã§)', answer: 'ÍªòÏÑú Ï£ºÎ¨¥ÏÑ∏Ïöî', type: 'particle+verb', hint: 'subject particle + honorific ÏûêÎã§' },
            { sentence: 'ÏÑ†ÏÉùÎãò_____ Ï±ÖÏùÑ _____. (ÏùΩÎã§)', answer: 'ÍªòÏÑú ÏùΩÏúºÏÑ∏Ïöî', type: 'particle+verb', hint: 'subject particle + honorific form' },
            { sentence: 'Î∂ÄÎ™®ÎãòÍªò ÏÑ†Î¨ºÏùÑ _____. (Ï£ºÎã§)', answer: 'ÎìúÎ†∏Ïñ¥Ïöî', type: 'verb', hint: 'honorific past tense of Ï£ºÎã§' },
            { sentence: 'Ìï†Î®∏Îãà _____Í∞Ä Ïñ¥ÎñªÍ≤å ÎêòÏÑ∏Ïöî? (ÎÇòÏù¥)', answer: 'Ïó∞ÏÑ∏', type: 'noun', hint: 'honorific word for age' },
            { sentence: 'ÍµêÏàòÎãò _____Ïù¥ Ïñ¥ÎñªÍ≤å ÎêòÏÑ∏Ïöî? (Ïù¥Î¶Ñ)', answer: 'ÏÑ±Ìï®', type: 'noun', hint: 'honorific word for name' },
            { sentence: 'Ïñ¥Î®∏Îãà _____Ïóê Í∞ÄÏÖ®Ïñ¥Ïöî. (Ïßë)', answer: 'ÎåÅ', type: 'noun', hint: 'honorific word for house' },
            { sentence: 'Ìï†ÏïÑÎ≤ÑÏßÄ _____Ïù¥ Ïñ∏Ï†úÏÑ∏Ïöî? (ÏÉùÏùº)', answer: 'ÏÉùÏã†', type: 'noun', hint: 'honorific word for birthday' },
            { sentence: 'ÏÑ†ÏÉùÎãòÍªòÏÑú _____. (Ï£ΩÎã§)', answer: 'ÎèåÏïÑÍ∞ÄÏÖ®Ïñ¥Ïöî', type: 'verb', hint: 'honorific form of Ï£ΩÎã§' },
            { sentence: 'Ìï†Î®∏ÎãàÍªòÏÑú Í±¥Í∞ï_____. (ÌïòÎã§)', answer: 'ÌïòÏÑ∏Ïöî', type: 'verb', hint: 'honorific present tense' },
            { sentence: 'Î∂ÄÎ™®ÎãòÍªò Ï†ÑÌôîÎ•º _____. (ÌïòÎã§)', answer: 'ÎìúÎ†∏Ïñ¥Ïöî', type: 'verb', hint: 'or ÌñàÏñ¥Ïöî - both acceptable' },
            { sentence: 'ÍµêÏàòÎãòÍªòÏÑú Ïò§Îäò _____? (Ïò§Îã§)', answer: 'Ïò§ÏÑ∏Ïöî', type: 'verb', hint: 'honorific present/future' },
        ];

        const modifierQuestions = [
            { adjective: 'Ï¢ãÎã§', answer: 'Ï¢ãÏùÄ', type: 'regular-C', example: 'Ï¢ãÏùÄ Ï∞® (nice car)' },
            { adjective: 'ÎßéÎã§', answer: 'ÎßéÏùÄ', type: 'regular-C', example: 'ÎßéÏùÄ ÏÇ¨Îûå (many people)' },
            { adjective: 'ÏûëÎã§', answer: 'ÏûëÏùÄ', type: 'regular-C', example: 'ÏûëÏùÄ Ïßë (small house)' },
            { adjective: 'ÌÅ¨Îã§', answer: 'ÌÅ∞', type: 'regular-V', example: 'ÌÅ∞ Í∞ÄÎ∞© (big bag)' },
            { adjective: 'Ïã∏Îã§', answer: 'Ïãº', type: 'regular-V', example: 'Ïãº Ïò∑ (cheap clothes)' },
            { adjective: 'ÏòàÏÅòÎã§', answer: 'ÏòàÏÅú', type: 'regular-V', example: 'ÏòàÏÅú ÍΩÉ (pretty flower)' },
            { adjective: 'Ï∂•Îã§', answer: 'Ï∂îÏö¥', type: '„ÖÇ-irregular', example: 'Ï∂îÏö¥ ÎÇ†Ïî® (cold weather)' },
            { adjective: 'Îç•Îã§', answer: 'ÎçîÏö¥', type: '„ÖÇ-irregular', example: 'ÎçîÏö¥ Ïó¨Î¶Ñ (hot summer)' },
            { adjective: 'ÏâΩÎã§', answer: 'Ïâ¨Ïö¥', type: '„ÖÇ-irregular', example: 'Ïâ¨Ïö¥ Î¨∏Ï†ú (easy problem)' },
            { adjective: 'Ïñ¥Î†µÎã§', answer: 'Ïñ¥Î†§Ïö¥', type: '„ÖÇ-irregular', example: 'Ïñ¥Î†§Ïö¥ ÏãúÌóò (difficult exam)' },
            { adjective: 'Í∞ÄÍπùÎã§', answer: 'Í∞ÄÍπåÏö¥', type: '„ÖÇ-irregular', example: 'Í∞ÄÍπåÏö¥ Í≥≥ (nearby place)' },
            { adjective: 'Ï¢ÅÎã§', answer: 'Ï¢ÅÏùÄ', type: '„ÖÇ-regular', example: 'Ï¢ÅÏùÄ Í∏∏ (narrow road)' },
            { adjective: 'ÏßßÎã§', answer: 'ÏßßÏùÄ', type: '„ÖÇ-regular', example: 'ÏßßÏùÄ Î®∏Î¶¨ (short hair)' },
            { adjective: 'ÎÑìÎã§', answer: 'ÎÑìÏùÄ', type: '„ÖÇ-regular', example: 'ÎÑìÏùÄ Î∞© (wide room)' },
            { adjective: 'Î©ÄÎã§', answer: 'Î®º', type: '„Ñπ-irregular', example: 'Î®º Í≥≥ (far place)' },
            { adjective: 'Í∏∏Îã§', answer: 'Í∏¥', type: '„Ñπ-irregular', example: 'Í∏¥ Î®∏Î¶¨ (long hair)' },
            { adjective: 'ÎßõÏûàÎã§', answer: 'ÎßõÏûàÎäî', type: 'special-ÏûàÎã§', example: 'ÎßõÏûàÎäî ÏùåÏãù (tasty food)' },
            { adjective: 'ÎßõÏóÜÎã§', answer: 'ÎßõÏóÜÎäî', type: 'special-ÏûàÎã§', example: 'ÎßõÏóÜÎäî ÌîºÏûê (bad pizza)' },
            { adjective: 'Ïû¨ÎØ∏ÏûàÎã§', answer: 'Ïû¨ÎØ∏ÏûàÎäî', type: 'special-ÏûàÎã§', example: 'Ïû¨ÎØ∏ÏûàÎäî ÏòÅÌôî (fun movie)' },
            { adjective: 'Ïû¨ÎØ∏ÏóÜÎã§', answer: 'Ïû¨ÎØ∏ÏóÜÎäî', type: 'special-ÏóÜÎã§', example: 'Ïû¨ÎØ∏ÏóÜÎäî Ï±Ö (boring book)' },
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let quizCategory = '';
        let quizType = '';
        let quizQuestions = [];
        let currentQuestion = null;
        let missedQuestions = [];
        let currentAnswerLang = '';

        // Enter key event listener
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                const nextBtn = document.getElementById('nextBtn');
                const answerInput = document.getElementById('answerInput');
                
                if (nextBtn.classList.contains('show')) {
                    nextQuestion();
                } else if (answerInput === document.activeElement && answerInput.value.trim()) {
                    checkAnswer();
                }
            }
        });

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function normalizeAnswer(answer) {
            return answer.toLowerCase().trim().replace(/[;,]/g, '');
        }

        function startQuiz(category, type) {
            quizCategory = category;
            quizType = type;
            currentQuestionIndex = 0;
            score = 0;
            missedQuestions = [];
            
            if (category === 'vocab') {
                quizQuestions = shuffleArray([...vocabulary]);
            } else if (category === 'grammar') {
                if (type === 'particles') {
                    quizQuestions = shuffleArray([...particleQuestions]);
                } else if (type === 'honorifics') {
                    quizQuestions = shuffleArray([...honorificQuestions]);
                } else if (type === 'modifiers') {
                    quizQuestions = shuffleArray([...modifierQuestions]);
                }
            }
            
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('quizArea').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= quizQuestions.length) {
                showResults();
                return;
            }

            currentQuestion = quizQuestions[currentQuestionIndex];
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / quizQuestions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Update question number
            document.getElementById('questionNumber').textContent = 
                `Question ${currentQuestionIndex + 1} of ${quizQuestions.length}`;
            
            // Clear previous state
            document.getElementById('feedback').classList.remove('show', 'correct', 'incorrect');
            document.getElementById('feedback').textContent = '';
            document.getElementById('nextBtn').classList.remove('show');
            document.getElementById('overrideBtn').classList.remove('show');
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').disabled = false;
            document.getElementById('sentenceContext').style.display = 'none';
            document.getElementById('hint').textContent = '';
            
            if (quizCategory === 'vocab') {
                showVocabQuestion();
            } else if (quizCategory === 'grammar') {
                showGrammarQuestion();
            }
            
            // Focus on input
            setTimeout(() => document.getElementById('answerInput').focus(), 100);
        }

        function showVocabQuestion() {
            const vocab = currentQuestion;
            document.getElementById('wordType').textContent = vocab.type;
            document.getElementById('wordType').style.display = 'inline-block';
            
            // Determine question direction
            if (quizType === 'korean-to-english') {
                currentAnswerLang = 'english';
                document.getElementById('questionText').textContent = vocab.korean;
                document.getElementById('hint').textContent = 'Type the English meaning';
            } else if (quizType === 'english-to-korean') {
                currentAnswerLang = 'korean';
                document.getElementById('questionText').textContent = vocab.english;
                document.getElementById('hint').textContent = 'Type the Korean word (in Hangul)';
            } else {
                // Mixed mode
                if (Math.random() < 0.5) {
                    currentAnswerLang = 'english';
                    document.getElementById('questionText').textContent = vocab.korean;
                    document.getElementById('hint').textContent = 'Type the English meaning';
                } else {
                    currentAnswerLang = 'korean';
                    document.getElementById('questionText').textContent = vocab.english;
                    document.getElementById('hint').textContent = 'Type the Korean word (in Hangul)';
                }
            }
        }

        function showGrammarQuestion() {
            document.getElementById('wordType').style.display = 'none';
            
            if (quizType === 'particles') {
                const q = currentQuestion;
                document.getElementById('questionText').textContent = q.sentence;
                document.getElementById('hint').textContent = `Hint: ${q.hint}`;
            } else if (quizType === 'honorifics') {
                const q = currentQuestion;
                document.getElementById('questionText').textContent = q.sentence;
                document.getElementById('hint').textContent = `Hint: ${q.hint}`;
            } else if (quizType === 'modifiers') {
                const q = currentQuestion;
                document.getElementById('questionText').textContent = 
                    `Convert to noun-modifying form: ${q.adjective}`;
                document.getElementById('hint').textContent = `Example: ${q.example}`;
            }
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value;
            if (!userAnswer.trim()) return;
            
            let isCorrect = false;
            let correctAnswer = '';
            
            if (quizCategory === 'vocab') {
                correctAnswer = currentQuestion[currentAnswerLang];
                const normalized = normalizeAnswer(userAnswer);
                const normalizedCorrect = normalizeAnswer(correctAnswer);
                
                isCorrect = normalized === normalizedCorrect;
            } else if (quizCategory === 'grammar') {
                if (quizType === 'honorifics' && currentQuestion.type === 'particle+verb') {
                    // For particle+verb questions, accept variations
                    const answers = currentQuestion.answer.split(' ');
                    const userWords = userAnswer.trim().split(/\s+/);
                    isCorrect = userWords.length === 2 && 
                                normalizeAnswer(userWords[0]) === normalizeAnswer(answers[0]) &&
                                normalizeAnswer(userWords[1]) === normalizeAnswer(answers[1]);
                } else if (quizType === 'honorifics' && currentQuestion.sentence.includes('Ï†ÑÌôîÎ•º')) {
                    // For Ï†ÑÌôîÎ•º ÎìúÎ¶¨Îã§/ÌïòÎã§ both are acceptable
                    isCorrect = normalizeAnswer(userAnswer) === normalizeAnswer(currentQuestion.answer) ||
                                normalizeAnswer(userAnswer) === 'ÌñàÏñ¥Ïöî';
                } else {
                    isCorrect = normalizeAnswer(userAnswer) === normalizeAnswer(currentQuestion.answer);
                }
                correctAnswer = currentQuestion.answer;
            }
            
            document.getElementById('answerInput').disabled = true;
            
            const feedback = document.getElementById('feedback');
            feedback.classList.add('show');
            
            const overrideBtn = document.getElementById('overrideBtn');
            
            if (isCorrect) {
                score++;
                feedback.classList.add('correct');
                
                // For English to Korean vocab, show answer comparison even when correct
                if (quizCategory === 'vocab' && currentAnswerLang === 'korean') {
                    feedback.innerHTML = `‚úì Correct! ÏûòÌñàÏñ¥Ïöî!<br>
                        <div class="answer-comparison">
                            <strong>You answered:</strong> ${userAnswer}<br>
                            <strong>Expected answer:</strong> ${correctAnswer}
                        </div>`;
                } else {
                    feedback.textContent = '‚úì Correct! ÏûòÌñàÏñ¥Ïöî!';
                }
                overrideBtn.classList.remove('show');
            } else {
                feedback.classList.add('incorrect');
                
                // Show answer comparison for English to Korean vocab quiz
                if (quizCategory === 'vocab' && currentAnswerLang === 'korean') {
                    feedback.innerHTML = `‚úó Incorrect.<br>
                        <div class="answer-comparison">
                            <strong>You answered:</strong> ${userAnswer}<br>
                            <strong>Correct answer:</strong> ${correctAnswer}
                        </div>`;
                    overrideBtn.classList.add('show');
                } else {
                    feedback.textContent = `‚úó Incorrect. The correct answer is: ${correctAnswer}`;
                    overrideBtn.classList.remove('show');
                }
                
                // Add to missed questions initially (will be removed if overridden)
                if (!missedQuestions.includes(currentQuestion)) {
                    missedQuestions.push(currentQuestion);
                }
            }
            
            document.getElementById('nextBtn').classList.add('show');
        }

        function overrideAnswer() {
            const feedback = document.getElementById('feedback');
            const overrideBtn = document.getElementById('overrideBtn');
            
            // Change feedback to correct
            feedback.classList.remove('incorrect');
            feedback.classList.add('correct');
            feedback.textContent = '‚úì Override accepted! Marked as correct. ÏûòÌñàÏñ¥Ïöî!';
            
            // Hide override button
            overrideBtn.classList.remove('show');
            
            // Add to score
            score++;
            
            // Remove from missed questions
            const index = missedQuestions.indexOf(currentQuestion);
            if (index > -1) {
                missedQuestions.splice(index, 1);
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        function showResults() {
            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            
            const percentage = Math.round((score / quizQuestions.length) * 100);
            document.getElementById('scoreDisplay').textContent = `${score} / ${quizQuestions.length}`;
            
            let message = '';
            if (percentage >= 90) {
                message = 'üåü Outstanding! ÎåÄÎã®Ìï¥Ïöî!';
            } else if (percentage >= 80) {
                message = 'üëè Great job! ÏûòÌñàÏñ¥Ïöî!';
            } else if (percentage >= 70) {
                message = 'üëç Good work! Ï¢ãÏïÑÏöî!';
            } else if (percentage >= 60) {
                message = 'üìö Keep studying! ÌôîÏù¥ÌåÖ!';
            } else {
                message = 'üí™ Practice makes perfect! ÌûòÎÇ¥ÏÑ∏Ïöî!';
            }
            
            document.getElementById('scoreMessage').textContent = message;
            
            // Enable/disable missed questions button
            const missedBtn = document.getElementById('missedBtn');
            if (missedQuestions.length === 0) {
                missedBtn.disabled = true;
                missedBtn.textContent = 'Practice Missed Only (None!)';
            } else {
                missedBtn.disabled = false;
                missedBtn.textContent = `Practice Missed Only (${missedQuestions.length})`;
            }
        }

        function returnToMenu() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
        }

        function retryQuiz() {
            startQuiz(quizCategory, quizType);
        }

        function retryMissed() {
            if (missedQuestions.length === 0) return;
            
            currentQuestionIndex = 0;
            score = 0;
            quizQuestions = shuffleArray([...missedQuestions]);
            missedQuestions = [];
            
            document.getElementById('results').style.display = 'none';
            document.getElementById('quizArea').style.display = 'block';
            
            showQuestion();
        }
    </script>
</body>
</html>